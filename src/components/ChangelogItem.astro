---
interface Props {
	version: string
	title: string
	date: string
	isLatest?: boolean
	htmlContent?: string
}

const { version, title, date, isLatest = false, htmlContent } = Astro.props

// Format the date
const formatDate = (dateString: string) => {
	const date = new Date(dateString)
	return date.toLocaleDateString("en-US", {
		year: "numeric",
		month: "long",
		day: "numeric",
	})
}

// If two numbers or ends with 0, return "Major"
const updateType = (version: string) => {
	const parts = version.split(".").map(Number)
	if (parts.length <= 2) return "Major"
	if (parts[2] === 0) return "Major"
	return "Minor"
}

const updateString = updateType(version)
---

<article
	class="changelog-item bg-gray-800/50 border border-gray-700/50 rounded-lg p-6 sm:px-8 transition-all duration-300 relative overflow-hidden shadow-md shadow-gray-950/50">
	{
		isLatest && (
			<div class="bg-primary text-green-300 text-sm rounded-full inline-block bg-green-500/25 px-2.5 py-0.5 mb-2 border border-green-400/50 mr-0.5">
				Latest Release
			</div>
		)
	}

	{
		updateString === "Major" ? (
			<div class="bg-primary text-blue-300 text-sm rounded-full inline-block bg-blue-500/25 px-2.5 py-0.5 mb-2 border border-blue-400/50 mr-0.5">
				Major Update
			</div>
		) : (
			<div class="bg-primary text-gray-300 text-sm rounded-full inline-block bg-gray-500/25 px-2.5 py-0.5 mb-2 border border-gray-400/50 mr-0.5">
				Minor Update
			</div>
		)
		
	}

	<time class="text-sm text-gray-400 px-1" datetime={date}>
		{formatDate(date)}
	</time>

	<header class="mb-4 border-b border-gray-700/70 pb-4">
		<div class="flex flex-wrap items-baseline gap-3 mb-2">
			<h3 class="text-3xl font-semibold text-white">
				Update {version} <span class="inline font-normal">- {title}</span>
			</h3>
		</div>
	</header>

	<div class="changelog-content prose prose-invert max-w-none text-gray-300">
		{htmlContent ? <div set:html={htmlContent} /> : <slot />}
	</div>

	{
		isLatest && (
		<h3 class="text-2xl font-semibold text-white mt-6">
				ðŸ“¦ Free Downloads
			</h3>
			<div class="mt-6 flex flex-col sm:flex-row items-center gap-3 sm:gap-4">
				<a
					href="https://apps.microsoft.com/detail/9N45NSM4TNBP?mode=direct"
					class="inline-block">
					<img
						src="https://get.microsoft.com/images/en-us%20light.svg"
						alt="Get it from Microsoft"
						class="h-12 sm:h-14 button-hover-effect duration-300"
					/>
				</a>
				<a
					href="https://github.com/unchihugo/FluentFlyout/releases/latest"
					class="inline-flex items-center button-hover-effect border-2 border-white/25 text-white font-semibold py-3 px-6 rounded-lg transition duration-300 hover:bg-gray-50 hover:border-gray-700 hover:scale-105">
					<svg
						class="w-5 h-5 mr-2"
						fill="currentColor"
						viewBox="0 0 16 16">
						<path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z" />
					</svg>
					Download from GitHub
				</a>
			</div>
		)
	}
</article>

<style>
	.prose :global(h2) {
		color: #fff;
		font-size: 1.5rem;
		font-weight: 600;
		margin-top: 1.5rem;
		margin-bottom: 0.75rem;
		font-family: var(--font-segoe-ui-variable-display);
	}

	.prose :global(h3) {
		color: #e5e7eb;
		font-size: 1.25rem;
		font-weight: 600;
		margin-top: 1.25rem;
		margin-bottom: 0.5rem;
		font-family: var(--font-segoe-ui-variable-display);
	}

	.prose :global(h4) {
		color: #d1d5db;
		font-size: 1.1rem;
		font-weight: 600;
		margin-top: 1rem;
		margin-bottom: 0.5rem;
		font-family: var(--font-segoe-ui-variable-display);
	}

	.prose :global(p) {
		margin-bottom: 1rem;
		line-height: 1.7;
	}

	.prose :global(p:last-child) {
		margin-bottom: 0;
	}

	.prose :global(ul) {
		list-style-type: disc;
		margin: 1rem 0;
		padding-left: 1.5rem;
	}

	.prose :global(ol) {
		list-style-type: decimal;
		margin: 1rem 0;
		padding-left: 1.5rem;
	}

	.prose :global(li) {
		margin: 0.5rem 0;
		line-height: normal;
	}

	.prose :global(li::marker) {
		color: white;
	}

	.prose :global(strong),
	.prose :global(b) {
		color: #fff;
		font-weight: 600;
	}

	.prose :global(code) {
		background-color: rgba(255, 255, 255, 0.1);
		padding: 0.2rem 0.4rem;
		border-radius: 0.25rem;
		font-size: 0.9em;
		color: #fbbf24;
	}

	.prose :global(pre) {
		background-color: rgba(0, 0, 0, 0.3);
		padding: 1rem;
		border-radius: 0.5rem;
		overflow-x: auto;
		margin: 1rem 0;
	}

	.prose :global(pre code) {
		background-color: transparent;
		padding: 0;
		color: #e5e7eb;
	}

	.prose :global(a) {
		color: rgb(96, 165, 250);
		text-decoration: underline;
		transition: color 0.2s;
	}

	.prose :global(a:hover) {
		color: rgb(147, 197, 253);
	}

	.prose :global(blockquote) {
		border-left: 4px solid rgb(var(--primary-rgb, 59, 130, 246));
		padding-left: 1rem;
		margin: 1rem 0;
		font-style: italic;
		color: #d1d5db;
	}

	.prose :global(hr) {
		border: none;
		border-top: 1px solid rgba(255, 255, 255, 0.1);
		margin: 1.5rem 0;
	}

	.prose :global(img) {
		border-radius: var(--radius-lg);
		margin: 1rem 0;
		max-width: 100%;
		height: auto;
	}
</style>
